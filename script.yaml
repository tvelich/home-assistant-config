backyard_timer_start:
  sequence:
    - service: timer.start
      data_template:
        entity_id: timer.backyard_lights
        duration: >
          {% set hour=states("sensor.time").split(':')[0] | int %}
          {% if hour >= 22 or hour <= 8 %}
            00:05:00
          {% else %}
            00:15:00
          {% endif %}
bedtime:
  sequence:
    - service: alarm_control_panel.alarm_arm_home
      data:
        entity_id: alarm_control_panel.abode_alarm
    - service: homeassistant.turn_off
      data:
        entity_id:
          - light.upstairs
          - switch.dining_room_lights
          - media_player.dining_room_home
          - media_player.family_room_home
          - media_player.family_room_speakers
          - media_player.guest_room_speakers
          - media_player.kitchen_chromecast
          - media_player.living_room_chromecast
          - media_player.living_room_home
          - media_player.living_room_speakers
          - media_player.garage_home
          - media_player.sunroom_home
          - remote.family_room
          - remote.living_room
    - service: script.vacuum_start
noop:
  sequence:
    delay: '00:00:00'
post_slack_message:
  sequence:
    - service: rest_command.slack_api
      data_template:
        endpoint: chat.postMessage
        payload: >
          {
            "channel": "{{ states('sensor.slack_home_assistant_channel_id') }}",
            "text": "{{ message }}"
          }
vacuum_start:
  sequence:
    - service_template: >
        {% if is_state('input_boolean.is_roomba_enabled', 'on') %}
          vacuum.turn_on
        {% else %}
          script.noop
        {% endif %}
      data:
        entity_id: vacuum.roomba
    - service_template: >
        {% set isRoombaEnabled = is_state('input_boolean.is_roomba_enabled', 'on') %}
        {% set isArmedHome = is_state('alarm_control_panel.abode_alarm', 'armed_home') %}
        {% if isRoombaEnabled and isArmedHome %}
          light.turn_on
        {% else %}
          script.noop
        {% endif %}
      data:
        entity_id: light.downstairs
        brightness: 125
wake:
  sequence:
    - service: alarm_control_panel.alarm_disarm
      data:
        entity_id: alarm_control_panel.abode_alarm
    - service: script.inside_lights_on
    - service: remote.turn_on
      data:
        entity_id: remote.living_room
    - service: homeassistant.turn_off
      data:
        entity_id:
          - media_player.master_bedroom_home
colorloop_bar_lights:
  sequence:
    - service: light.turn_on
      data:
        entity_id:
          - light.hue_bloom_1
          - light.hue_lightstrip_plus_1
        brightness: 255
        xy_color: [0,0]
    - delay: '00:00:01'
    - service: light.turn_on
      data:
        entity_id:
          - light.hue_bloom_1
          - light.hue_lightstrip_plus_1
        brightness: 255
        effect: colorloop
upstairs_lights_on:
  sequence:
    - service: light.turn_on
      data:
        entity_id: light.upstairs
        brightness: 255
        xy_color: [0.31495,0.32501]
    - service: switch.turn_on
      data:
        entity_id: switch.dining_room_lights
upstairs_lights_off:
  sequence:
    service: homeassistant.turn_off
    data:
      entity_id:
        - light.upstairs
        - switch.dining_room_lights
downstairs_lights_on:
  sequence:
    - service: light.turn_on
      data:
        entity_id: light.downstairs
        brightness: 255
        xy_color: [0.31495,0.32501]
    - delay: '00:00:01'
    - service: script.colorloop_bar_lights
downstairs_lights_off:
  sequence:
    service: light.turn_off
    data:
      entity_id: light.downstairs
inside_lights_on:
  sequence:
    - service: light.turn_on
      data:
        entity_id: light.inside_core
        brightness: 255
        xy_color: [0.31495,0.32501]
    - service: switch.turn_on
      data:
        entity_id: switch.dining_room_lights
    - delay: '00:00:01'
    - service: script.colorloop_bar_lights
inside_lights_off:
  sequence:
    service: homeassistant.turn_off
    data:
      entity_id:
        - light.inside
        - switch.dining_room_lights
colorloop_landscape_lights:
  sequence:
    - service: homeassistant.turn_on
      data:
        entity_id: light.landscape_spot
        brightness: 255
        xy_color: [0,0]
    - delay: '00:00:01'
    - service: light.turn_on
      data:
        entity_id: light.landscape_spot
        brightness: 255
        effect: colorloop
fade_to_dim_front_yard:
  sequence:
    - service: light.turn_on
      data:
        entity_id: light.front_yard
        brightness: 85
        transition: 60
outside_core_lights_on_default:
  sequence:
    - service: homeassistant.turn_on
      data:
        entity_id:
          - light.front_yard
          - light.landscape_spot
        brightness: 255
        xy_color: [0.31495,0.32501]
    - service: light.turn_on
      data:
        entity_id: light.landscape_path
        brightness: 85
        xy_color: [0.31495,0.32501]
    - delay: '00:00:01'
    - service: script.colorloop_landscape_lights
outside_core_lights_on_christmas:
  sequence:
    - service: light.turn_on
      data:
        entity_id: light.holiday_outside_color_1
        brightness: 255
        color_name: green
    - service: light.turn_on
      data:
        entity_id: light.holiday_outside_color_2
        brightness: 255
        color_name: red
    - service: switch.turn_on
      data:
        entity_id: switch.outdoor_string_holiday_lights
outside_core_lights_on:
  sequence:
    service_template: >
      {% set now=now() %}
      {% if (now.month == 11 and now.day > 24) or (now.month == 12 and now.day < 31) %}
        script.outside_core_lights_on_christmas
      {% else %}
        script.outside_core_lights_on_default
      {% endif %}
outside_lights_on:
  sequence:
    - service: light.turn_on
      data:
        entity_id: light.outside
        brightness: 255
        xy_color: [0.31495,0.32501]
    - service: light.turn_on
      data:
        entity_id: light.landscape_path
        brightness: 85
        xy_color: [0.31495,0.32501]
    - delay: '00:00:01'
    - service: script.colorloop_landscape_lights
outside_lights_off:
  sequence:
    service: homeassistant.turn_off
    data:
      entity_id:
        - light.outside
        - switch.outdoor_string_holiday_lights
